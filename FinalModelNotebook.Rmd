---
title: "Final Model"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(caret)
library(ROSE)
bank_full <- read.csv("bank-additional-full.csv", header=TRUE, sep = ';')
summary(bank_full)
sapply(bank_full, class)

#Convert Columns to Numeric
#Move previous into other list 
num.cols <- c("age","duration","campaign","pdays","previous","emp.var.rate","cons.price.idx","cons.conf.idx","euribor3m","nr.employed")
bank_full[num.cols] <- lapply(bank_full[num.cols], as.numeric)
sapply(bank_full, class)

#Convert Columns to Factor
#Note: Converted previous to factor
fac.col <- c("job","marital","education","default","housing","loan","contact","month","day_of_week", "poutcome","y","previous")
bank_full[fac.col] <- lapply(bank_full[fac.col], as.factor)
sapply(bank_full, class)
```

```{r}
#Train/Test set split
multicol.bank = bank_full[-c(16,17,19,20)]
multicol.banksample <- ovun.sample(y~., data=multicol.bank, method="under",seed= 1234)$data
table(multicol.banksample$y)

set.seed(1234)
splitPerc = .85
trainIndices = sample(1:dim(multicol.banksample)[1], round(splitPerc * dim(multicol.banksample)[1]))
train = multicol.banksample[trainIndices,]
test = multicol.banksample[-trainIndices,]
```

```{r}
library(car)
library(glmnet)
set.seed(1234)
simple.bankdata = bank_full[-c(16,17,19,20)]
fitControl <- trainControl(method = "cv",number = 5)
simple.lasso <- train(y ~.,
                  data=simple.bankdata, method = "glmnet", 
                  trControl = fitControl,
                  tuneGrid=expand.grid(
                    .alpha=1,
                    .lambda=10^seq(-5, 5, length =15)),
                  family="binomial", preProcess = c("center", "scale"))

simple.lasso$bestTune
simple.lasso$finalModel$tuneValue
coef(simple.lasso$finalModel,simple.lasso$finalModel$lambdaOpt)
varImp(simple.lasso)
simple.lasso$results
```
age,job, marital, education, default, contact, month, dayofweek, duration, campaign, pdays, previous, and cons.conf.idx kept in the model

housing, and loan removed
Fitting the model with
```{r}
names(simple.bankdata)
simple.finaldata = simple.bankdata[-c(6,7)]
simplefinalmodel = glm(y~.,data = simple.finaldata, family = binomial)
summary(simplefinalmodel)
```


Complex Model
```{r}

```


```{r}
bank_balance <- ovun.sample(y~., data=bank_full, method="under",seed= 1234)$data
table(bank_balance$y)

set.seed(1234)
splitPerc = .85
trainIndices = sample(1:dim(bank_balance)[1], round(splitPerc * dim(bank_balance)[1]))
train = bank_balance[trainIndices,]
test = bank_balance[-trainIndices,]
```




